<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Solar System Simulation v8.4</title>
<style>
html, body { margin:0; padding:0; overflow:hidden; background:#000; font-family:sans-serif; touch-action:none; }
#ui { position:absolute; top:10px; left:10px; z-index:100; background:rgba(0,0,0,0.5); padding:10px; border-radius:8px; color:#fff; width:220px;}
label{display:block; margin:5px 0;}
button{display:block; margin-top:5px; width:100%;}
.info-box {position:absolute; background:rgba(0,0,0,0.8); color:#fff; padding:6px 10px; border-radius:6px; pointer-events:none; font-size:12px; max-width:220px; display:none;}
#versionLabel { position:absolute; bottom:5px; right:10px; color:rgba(255,255,255,0.5); font-size:14px; z-index:100;}
#compressionLabel { position:absolute; bottom:30px; right:10px; color:rgba(255,255,255,0.6); font-size:12px; z-index:100;}
</style>
</head>
<body>
<div id="ui">
  <label>Speed: <input type="range" id="speedSlider" min="0" max="10" value="5" step="0.1"></label>
  <label>Distance Compression / Zoom: <input type="range" id="distSlider" min="0.05" max="2" value="0.5" step="0.01"></label>
  <label>Trail Length: <input type="range" id="trailSlider" min="10" max="200" value="50" step="1"></label>
  <button id="toggleTilt">Tilt OFF (Pan ON)</button>
  <button id="resetView">Reset View</button>
</div>
<div id="versionLabel">v8.4</div>
<div id="compressionLabel"></div>
<div id="infoBox" class="info-box"></div>

<script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
<script>
let planets=[
  {name:"Mercury", color:"#a9a9a9", a:57.9, radius:4, period:88, facts:"Mercury is the smallest planet and closest to the Sun."},
  {name:"Venus", color:"#f5deb3", a:108.2, radius:7, period:224.7, facts:"Venus spins backward, so the Sun rises in the west."},
  {name:"Earth", color:"#1e90ff", a:149.6, radius:8, period:365.2, facts:"Earth is the only planet known to support life."},
  {name:"Mars", color:"#ff4500", a:227.9, radius:6, period:687, facts:"Mars has the tallest volcano in the solar system, Olympus Mons."},
  {name:"Jupiter", color:"#ffa500", a:778.6, radius:14, period:4331, facts:"Jupiter is the largest planet and has a giant storm called the Great Red Spot."},
  {name:"Saturn", color:"#f0e68c", a:1433.5, radius:12, period:10747, facts:"Saturn's rings are made mostly of ice particles."},
  {name:"Uranus", color:"#7fffd4", a:2872.5, radius:10, period:30589, facts:"Uranus rotates on its side, making extreme seasons."},
  {name:"Neptune", color:"#4169e1", a:4495.1, radius:10, period:59800, facts:"Neptune has the strongest winds in the solar system."},
  {name:"Pluto", color:"#d3d3d3", a:5906.4, radius:3, period:90560, facts:"Pluto is a dwarf planet in the Kuiper belt."}
];

let trails={}, speedSlider, distSlider, trailSlider;
let stars=[];
let camX=0, camY=0, targetX=0, targetY=0, zoomLevel=1, targetZoom=1;
let tiltFactor=0.5, tiltControl=false;
let lastDist=0, lastMidX=0, lastMidY=0;
let infoBox, compressionLabel;
let maxOrbit;
let lastMouseY=0;
let isDragging=false, dragStartX=0, dragStartY=0, camStartX=0, camStartY=0;

function setup(){
  createCanvas(windowWidth, windowHeight);
  speedSlider=select('#speedSlider');
  distSlider=select('#distSlider');
  trailSlider=select('#trailSlider');
  infoBox=select('#infoBox');
  compressionLabel=select('#compressionLabel');

  select('#toggleTilt').mousePressed(toggleTilt);
  select('#resetView').mousePressed(resetView);

  maxOrbit=planets[planets.length-1].a;
  for(let p of planets) trails[p.name]=[];
  for(let i=0;i<1500;i++) stars.push({x:random(-width,width),y:random(-height,height),r:random(1,2)});
}

function toggleTilt(){
  tiltControl=!tiltControl;
  select('#toggleTilt').html(tiltControl ? 'Tilt ON' : 'Tilt OFF (Pan ON)');
}

function windowResized(){resizeCanvas(windowWidth,windowHeight);}
function resetView(){ targetX=0; targetY=0; targetZoom=1; tiltFactor=0.5; }

function draw(){
  background(0);
  noStroke(); fill(255);
  for(let s of stars) ellipse(s.x,s.y,s.r);

  camX += (targetX - camX)*0.05;
  camY += (targetY - camY)*0.05;
  zoomLevel += (targetZoom - zoomLevel)*0.05;

  translate(width/2, height/2*0.9);
  scale(zoomLevel);
  translate(-camX, -camY);

  let speedMult=speedSlider.value()/5;
  let compression=distSlider.value();
  let trailLength=trailSlider.value();

  let scaleFactor=min(width,height)/2 / maxOrbit * compression;
  compressionLabel.html(`Distance compression: ${compression.toFixed(2)}x`);

  let hoverPlanet=null;
  for(let p of planets){
    let t=frameCount*speedMult*(365/p.period)*0.05;
    p.angle=t;
    let r=p.a<5000 ? p.a*scaleFactor : scaleFactor*0.8*p.a/5000 + width*0.1;
    let x=r*cos(p.angle);
    let y=r*sin(p.angle)*tiltFactor;

    trails[p.name].push([x,y]);
    if(trails[p.name].length>trailLength) trails[p.name].shift();

    noFill(); stroke(255,30); ellipse(0,0,r*2,r*2*tiltFactor);

    beginShape();
    for(let i=0;i<trails[p.name].length;i++){
      let alpha=map(i,0,trails[p.name].length,0,255);
      stroke(p.color+hex(int(alpha),2));
      vertex(trails[p.name][i][0],trails[p.name][i][1]);
    }
    endShape();

    noStroke(); fill(p.color);
    ellipse(x,y,p.radius*2,p.radius*2);

    fill(255); textSize(12/zoomLevel); textAlign(CENTER);
    text(p.name,x,y-p.radius*2);

    let mx=(mouseX-width/2)/zoomLevel+camX;
    let my=(mouseY-height/2*0.9)/zoomLevel+camY;
    if(dist(mx,my,x,y)<p.radius*4){ hoverPlanet=p; }
  }

  if(hoverPlanet){
    infoBox.html(`<strong>${hoverPlanet.name}</strong><br>Radius: ${hoverPlanet.radius*1000} km approx<br>Distance: ${hoverPlanet.a} million km<br>Orbital period: ${hoverPlanet.period} days<br>${hoverPlanet.facts}`);
    infoBox.position(mouseX+10, mouseY+10);
    infoBox.style('display','block');
  } else { infoBox.style('display','none'); }
}

// Mouse wheel zoom
function mouseWheel(event){
  if(mouseX>220) return; // ignore UI
  let zoomChange=(event.delta>0)?0.95:1.05;
  let mouseXWorld=(mouseX-width/2)/zoomLevel+camX;
  let mouseYWorld=(mouseY-height/2*0.9)/zoomLevel+camY;
  targetZoom*=zoomChange;
  targetZoom=constrain(targetZoom,0.2,5);
  targetX=mouseXWorld-(mouseX-width/2)/targetZoom;
  targetY=mouseYWorld-(mouseY-height/2*0.9)/targetZoom;
}

// Dragging / tilt
function mousePressed(){
  if(mouseX>220) return; // ignore UI
  isDragging=true;
  dragStartX=mouseX;
  dragStartY=mouseY;
  camStartX=targetX;
  camStartY=targetY;
}

function mouseDragged(){
  if(mouseX>220) return;
  if(!isDragging) return;
  let dx=(mouseX-dragStartX)/zoomLevel;
  let dy=(mouseY-dragStartY)/zoomLevel;
  if(tiltControl){
    tiltFactor+=dy*0.005;
    tiltFactor=constrain(tiltFactor,0.1,1);
  } else {
    targetX=camStartX-dx;
    targetY=camStartY-dy;
  }
}

function mouseReleased(){ isDragging=false; }

// Touch controls
function touchMoved(event){
  event.preventDefault();
  if(touches.length==2){
    let d=dist(touches[0].x,touches[0].y,touches[1].x,touches[1].y);
    let midX=(touches[0].x+touches[1].x)/2;
    let midY=(touches[0].y+touches[1].y)/2;
    if(lastDist>0){
      let factor = 1 + (d - lastDist)*0.002;
      let worldX=(midX-width/2)/zoomLevel+camX;
      let worldY=(midY-height/2*0.9)/zoomLevel+camY;
      targetZoom*=factor;
      targetZoom=constrain(targetZoom,0.2,5);
      targetX=worldX-(midX-width/2)/targetZoom;
      targetY=worldY-(midY-height/2*0.9)/targetZoom;
    }
    lastDist=d; lastMidX=midX; lastMidY=midY;
  } else if(touches.length==1){
    let dy=touches[0].y-lastMouseY;
    let dx=touches[0].x-lastMouseY;
    if(tiltControl){
      tiltFactor+=dy*0.005;
      tiltFactor=constrain(tiltFactor,0.1,1);
    } else {
      targetX-=dx/zoomLevel; targetY-=dy/zoomLevel;
    }
    lastMouseY=touches[0].y;
  }
}
function touchEnded(){ lastDist=0; lastMidX=0; lastMidY=0; lastMouseY=0; }

</script>
</body>
</html>
